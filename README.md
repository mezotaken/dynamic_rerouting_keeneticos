# Инструкция по установке и настройке

## 1. Установка компонентов через веб-интерфейс:

   - Перейдите в раздел "Параметры системы" -> "Изменить набор компонентов"
   - Из подраздела "Пакеты OPKG" установите "Модули ядра для поддержки файловых систем", "Поддержка открытых пакетов"
   - Из подраздела "USB-накопители" установите "Файловая система Ext"

## 2. Форматирование флешки в Ext4:

   - Отформатируйте флешку в формат Ext4
   - Вставьте флешку в роутер
   - Зайдите на неё как на сетевой диск через веб-интерфейс в разделе "Приложения"

## 3. Создание папки и установка Entware:

   - Создайте папку `install` в корне флешки
   - Положите в эту папку инсталлятор `mipsel-installer.tar.gz`
   - В веб-интерфейсе выберите диск как накопитель в разделе "OPKG" и сохраните изменения

## 4. Проверка установки:

   - Перейдите в раздел "Диагностика" -> "Журнал"
   - Убедитесь, что установка прошла успешно
   - Будет сообщение об успешной установке Entware и логин/пароль для захода через ssh в терминал, а не в интерпретатор команд CLI (по порту 222, а не 22), но если в компонентах SSH-сервер не установлен, то будет 22.

## 5. Размещение и настройка скриптов в директориях-триггерах

   - Поместите скрипты из папки opt так же, как они лежат в репозитории
   - Укажите ID интерфейса VPN в скрипте toggle_rerouting.sh (можно узнать в переменной при включении/выключении VPN, выведя его в лог роутера `logger $system_name` в скрипте)

## 6. Выполнение команд:

   - Выполните следующие команды в терминале:
     ```
     opkg update && opkg upgrade
     opkg install nano bind-dig ipset iptables tcpdump
     chmod +x /opt/etc/ndm/netfilter.d/fwmark.sh
     chmod +x /opt/etc/ndm/iflayerchanged.d/toggle_rerouting.sh
     reboot
     ```
   - После этого роутер перезагрузится

## 7. Дополнение файла unblock.txt:

   - При изменении файла unblock.txt достаточно будет включить и выключить VPN в настройках роутера.
   - С помощью tcmpdump можно отслеживать домены и ip, нужные для разблокировки
